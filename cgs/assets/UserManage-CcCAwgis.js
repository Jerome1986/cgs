import{r as c,X as Y,o as M,b as e,w as s,e as G,f as O,h as q,Y as W,Z as H,_ as X,$ as J,g as I,p as R,m as N,a0 as K,q as z,u as Q,a1 as A,a2 as ee,a as ae,a3 as te,c as le,a4 as ne,a5 as se,L as oe,i as E,a6 as re,a7 as ue,a8 as ie,a9 as pe,aa as ce,ab as de,ac as me,W as ge}from"./index-Dq5YoMTe.js";/* empty css                        *//* empty css                      */import{P as ve}from"./pageContainer-BnKbueKC.js";/* empty css                     *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                   *//* empty css                     */import{i as x}from"./request-CjAdyTqz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const fe=(t,g,p)=>x.get("/user-get",{params:{role:t,pagesNum:g,pagesSize:p}}),_e=(t,g,p)=>x.put("/user-status-update",{id:t,status:g,role:p}),be=t=>x.post("/user-add",t,{headers:{"Content-Type":"application/json"}}),he=t=>x.put("/user-editInfo",t,{headers:{"Content-Type":"application/json"}}),ye=t=>x.delete("/user-deleted",{params:{id:t}}),Se=()=>x.get("/user-search-get"),Ce={class:"channelEdit"},xe={class:"dialog-footer"},Ee={__name:"ChannelUserEdit",emits:["success"],setup(t,{expose:g,emit:p}){const r=c(null),d=c(!1),l=c({username:"",role:"",coins:0}),h=[{value:"admin",label:"管理员"},{value:"user",label:"普通用户"},{value:"vip",label:"会员"}],v=c({role:[{required:!0,message:"请选择用户角色",trigger:"change"},{validator:(S,n,m)=>{["admin","user","vip"].includes(n)?m():m(new Error("角色必须是 admin、user 或 vip 中的一项"))},trigger:"change"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"},{pattern:/^[A-Za-z][A-Za-z0-9]{5,11}$/,message:"用户名必须是纯英文，且以英文开头，长度为 6-12 位",trigger:"blur"}],coins:[{required:!0,message:"请输入金币数量",trigger:"blur"},{validator:(S,n,m)=>{typeof n!="number"||n<0?m(new Error("金币必须为数字，且不能为负数")):m()},trigger:"blur"}]}),V=p,f=async()=>{await r.value.validate(),console.log(l.value,"表单"),l.value.coins=Number(l.value.coins),l.value._id||await be(l.value),l.value._id&&await he(l.value),z({type:"success",message:l.value._id?"更新成功":"添加成功"}),d.value=!1,V("success")};return g({open:S=>{d.value=!0,l.value={...S}}}),(S,n)=>{const m=q,C=O,D=J,_=W,y=G,w=R,k=K;return M(),Y("div",Ce,[e(k,{modelValue:d.value,"onUpdate:modelValue":n[4]||(n[4]=i=>d.value=i),title:l.value._id?"编辑用户":"添加用户",width:"30%"},{footer:s(()=>[I("span",xe,[e(w,{onClick:n[3]||(n[3]=i=>d.value=!1)},{default:s(()=>n[5]||(n[5]=[N("取消")])),_:1}),e(w,{type:"primary",onClick:f},{default:s(()=>n[6]||(n[6]=[N(" 确认 ")])),_:1})])]),default:s(()=>[e(y,{ref_key:"formRef",ref:r,model:l.value,rules:v.value,"label-width":"100px",style:{"padding-right":"30px"}},{default:s(()=>[e(C,{label:"用户名",prop:"username",required:""},{default:s(()=>[e(m,{modelValue:l.value.username,"onUpdate:modelValue":n[0]||(n[0]=i=>l.value.username=i),minlength:"6"},null,8,["modelValue"])]),_:1}),e(C,{label:"用户角色",prop:"role",required:""},{default:s(()=>[e(_,{modelValue:l.value.role,"onUpdate:modelValue":n[1]||(n[1]=i=>l.value.role=i),placeholder:"选择用户的角色",style:{width:"240px"}},{default:s(()=>[(M(),Y(H,null,X(h,i=>e(D,{key:i.value,label:i.label,value:i.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"金币",prop:"coins",required:""},{default:s(()=>[e(m,{modelValue:l.value.coins,"onUpdate:modelValue":n[2]||(n[2]=i=>l.value.coins=i),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};function Ve(t,g="YYYY-MM-DD HH:mm:ss"){if((typeof t=="string"||typeof t=="number")&&(t=new Date(t)),!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date");const p=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),h=String(t.getMinutes()).padStart(2,"0"),v=String(t.getSeconds()).padStart(2,"0");return g.replace("YYYY",p).replace("MM",r).replace("DD",d).replace("HH",l).replace("mm",h).replace("ss",v)}const we=["innerHTML"],Ue={style:{"margin-top":"20px"}},He={__name:"UserManage",setup(t){const g=ae(),p=Q(),r=c({pagesNum:1,pageSize:10}),d=c(0),l=c(),h=c(!1),v=c([]),V=c([]),f=async()=>{h.value=!0,p.userInfo.role!=="admin"&&await g.push("/login");const a=await fe(p.userInfo.role,r.value.pagesNum,r.value.pageSize);d.value=a.data.total,v.value=a.data.list,h.value=!1,y.value=v.value},T=async()=>{const a=await Se();V.value=a.data},S=()=>{l.value.open({}),r.value.pagesNum=Math.ceil(d.value/r.value.pageSize),f()},n=a=>{l.value.open(a)},m=()=>{f()},C=a=>{ge.confirm("确定要删除此分类吗?").then(async()=>{await ye(a._id),await f(),z.success("删除成功")}).catch(()=>{})},D=async a=>{const u=await _e(a._id,a.status,p.userInfo.role);console.log("更新结果",u),u.code===200&&a.status===0?z.error("禁用"):z.success("正常")},_=c(""),y=c([]);A(_,a=>{if(!a){y.value=v.value;return}const u=new RegExp(a,"i");y.value=V.value.filter($=>u.test($.username))}),A(v,a=>{_.value||(y.value=a)},{immediate:!0});const w=a=>{if(!_.value)return a;const u=new RegExp(`(${_.value})`,"gi");return a.replace(u,'<span style="color: #d96767;">$1</span>')},k=a=>{r.value.pagesNum=a,f()},i=a=>{r.value.pageSize=a,r.value.pagesNum=1,f()};return ee(()=>{f(),T()}),(a,u)=>{const $=q,L=R,b=se,B=re,j=pe,F=ne,P=de,Z=ce;return M(),Y(H,null,[e(ve,{title:"用户管理"},{extra:s(()=>[e($,{modelValue:_.value,"onUpdate:modelValue":u[0]||(u[0]=o=>_.value=o),style:{width:"240px","margin-right":"40px"},placeholder:"输入你要查找的用户名","suffix-icon":E(me)},null,8,["modelValue","suffix-icon"]),e(L,{type:"primary",onClick:S},{default:s(()=>u[3]||(u[3]=[N("添加用户")])),_:1})]),default:s(()=>[te((M(),le(F,{data:y.value,style:{width:"100%"}},{empty:s(()=>[e(j,{description:"没有数据"})]),default:s(()=>[e(b,{label:"序号",sortable:"",align:"center",width:"100",type:"index"}),e(b,{label:"用户名",align:"center",prop:"username"},{default:s(({row:o})=>[I("span",{innerHTML:w(o.username)},null,8,we)]),_:1}),e(b,{label:"用户角色",align:"center",prop:"role"}),e(b,{label:"金币",sortable:"",align:"center",prop:"coins"}),e(b,{label:"入驻时间",sortable:"",align:"center",prop:"createdAt"},{default:s(({row:o})=>[N(oe(E(Ve)(o.createdAt)),1)]),_:1}),e(b,{label:"会员期限",sortable:"",align:"center",prop:"end_date"}),e(b,{label:"用户状态",align:"center",prop:"status"},{default:s(({row:o})=>[e(B,{modelValue:o.status,"onUpdate:modelValue":U=>o.status=U,onChange:U=>D(o),size:"large",disabled:E(p).userInfo._id===o._id,"active-value":1,"inactive-value":0},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),e(b,{label:"操作",align:"center",width:"100"},{default:s(({row:o})=>[e(L,{icon:E(ue),circle:"",plain:"",type:"primary",onClick:U=>n(o)},null,8,["icon","onClick"]),e(L,{icon:E(ie),circle:"",plain:"",type:"danger",onClick:U=>C(o)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[Z,h.value]]),I("div",Ue,[e(P,{style:{"margin-top":"20px","justify-content":"flex-end"},"current-page":r.value.pagesNum,"onUpdate:currentPage":u[1]||(u[1]=o=>r.value.pagesNum=o),"page-size":r.value.pageSize,"onUpdate:pageSize":u[2]||(u[2]=o=>r.value.pageSize=o),"page-sizes":[1,5,10,15],layout:"jumper,total, sizes, prev, pager, next ",total:d.value,onSizeChange:i,onCurrentChange:k},null,8,["current-page","page-size","total"])])]),_:1}),e(Ee,{ref_key:"dialog",ref:l,onSuccess:m},null,512)],64)}}};export{He as default};
