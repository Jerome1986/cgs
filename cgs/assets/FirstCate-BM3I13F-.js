import{r as p,X as N,o as E,b as e,w as n,e as M,f as R,h as A,Y as J,Z as D,_ as K,c as Z,$ as Q,g as S,p as P,m as $,a0 as j,q,ad as F,a2 as ee,a3 as ae,i as T,ac as le,a4 as te,a5 as ne,ae as oe,a7 as se,a8 as ue,a9 as ie,aa as re,ab as pe,W as de}from"./index-Dq5YoMTe.js";/* empty css                        *//* empty css                      */import{P as me}from"./pageContainer-BnKbueKC.js";/* empty css                     *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                   *//* empty css                     */import{u as ce,a as ge,b as _e,c as ve,g as fe,r as ye}from"./pageTypes-DsWnsiwk.js";import{P as be}from"./pageTypes-CewWNZEg.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as xe}from"./cate-D2wB2MsT.js";import"./request-CjAdyTqz.js";const Ve={class:"channelEdit"},he={class:"dialog-footer"},Se={__name:"ChannelEdit",emits:["success"],setup(B,{expose:C,emit:w}){const u=p(!1),a=p({name:"",en_name:"",type:""}),V=p([{value:"模型",label:"模型"},{value:"贴图",label:"贴图"},{value:"材质",label:"材质"},{value:"灯光",label:"灯光"}]),f={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{pattern:/^\S{1,10}$/,message:"分类名必须是1-10位的非空字符",trigger:"blur"}],en_name:[{required:!0,message:"请输入分类英文",trigger:"blur"},{pattern:/^[a-zA-Z]+$/,message:"分类别名必须是纯英文，且长度为1-15位",trigger:"blur"},{min:1,max:15,message:"分类别名长度必须在1到15个字符之间",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"},{validator:(o,t,g)=>{["模型","贴图","材质","灯光"].includes(t)?g():g(new Error("类型必须是模型、贴图、材质、灯光中的一种"))},trigger:"change"}]};C({open:o=>{u.value=!0,a.value={...o}}});const s=w,_=p(null),d=async()=>{await _.value.validate();const o={top_id:a.value._id,name:a.value.name,en_name:a.value.en_name,type:a.value.type};a.value._id&&await ce(o),a.value._id||await ge(a.value),q({type:"success",message:a.value._id?"更新成功":"添加成功"}),u.value=!1,s("success")};return(o,t)=>{const g=A,y=R,h=Q,k=J,m=M,L=P,U=j;return E(),N("div",Ve,[e(U,{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=i=>u.value=i),title:a.value._id?"编辑分类":"添加分类",width:"30%"},{footer:n(()=>[S("span",he,[e(L,{onClick:t[3]||(t[3]=i=>u.value=!1)},{default:n(()=>t[5]||(t[5]=[$("取消")])),_:1}),e(L,{type:"primary",onClick:d},{default:n(()=>t[6]||(t[6]=[$(" 确认 ")])),_:1})])]),default:n(()=>[e(m,{ref_key:"formRef",ref:_,model:a.value,rules:f,"label-width":"100px",style:{"padding-right":"30px"}},{default:n(()=>[e(y,{label:"分类名称",prop:"name"},{default:n(()=>[e(g,{modelValue:a.value.name,"onUpdate:modelValue":t[0]||(t[0]=i=>a.value.name=i),minlength:"1",maxlength:"10"},null,8,["modelValue"])]),_:1}),e(y,{label:"分类英文",prop:"cate_alias"},{default:n(()=>[e(g,{modelValue:a.value.en_name,"onUpdate:modelValue":t[1]||(t[1]=i=>a.value.en_name=i),minlength:"1",maxlength:"15"},null,8,["modelValue"])]),_:1}),e(y,{label:"所属类型",prop:"cate_alias"},{default:n(()=>[e(k,{modelValue:a.value.type,"onUpdate:modelValue":t[2]||(t[2]=i=>a.value.type=i),placeholder:"Select",style:{width:"100px"}},{default:n(()=>[(E(!0),N(D,null,K(V.value,i=>(E(),Z(h,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ee={class:"channelEdit"},we={class:"dialog-footer"},ke={__name:"channel-subAdd",emits:["success"],setup(B,{expose:C,emit:w}){const u=p(!1),a=p({name:"",en_name:"",parent_id:null}),V={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{pattern:/^\S{1,10}$/,message:"分类名必须是1-10位的非空字符",trigger:"blur"}],en_name:[{required:!0,message:"请输入分类英文",trigger:"blur"},{pattern:/^[a-zA-Z]+$/,message:"分类别名必须是纯英文，且长度为1-15位",trigger:"blur"},{min:1,max:15,message:"分类别名长度必须在1到15个字符之间",trigger:"blur"}]},f=d=>{console.log(d),u.value=!0,a.value={parent_id:d._id,parent_name:d.name,type:d.type}},c=w;C({openSub:f});const s=p(null),_=async()=>{await s.value.validate();const d={parent_id:a.value.parent_id,name:a.value.name,en_name:a.value.en_name};await _e(d),q({type:"success",message:"添加成功"}),u.value=!1,c("success")};return(d,o)=>{const t=A,g=R,y=M,h=P,k=j;return E(),N("div",Ee,[e(k,{modelValue:u.value,"onUpdate:modelValue":o[4]||(o[4]=m=>u.value=m),title:"添加二级分类",width:"30%"},{footer:n(()=>[S("span",we,[e(h,{onClick:o[3]||(o[3]=m=>u.value=!1)},{default:n(()=>o[5]||(o[5]=[$("取消")])),_:1}),e(h,{type:"primary",onClick:_},{default:n(()=>o[6]||(o[6]=[$(" 确认 ")])),_:1})])]),default:n(()=>[e(y,{ref_key:"formRef",ref:s,model:a.value,rules:V,"label-width":"100px",style:{"padding-right":"30px"}},{default:n(()=>[e(g,{label:"分类名称",prop:"name"},{default:n(()=>[e(t,{modelValue:a.value.name,"onUpdate:modelValue":o[0]||(o[0]=m=>a.value.name=m),minlength:"1",maxlength:"10"},null,8,["modelValue"])]),_:1}),e(g,{label:"分类英文",prop:"cate_alias"},{default:n(()=>[e(t,{modelValue:a.value.en_name,"onUpdate:modelValue":o[1]||(o[1]=m=>a.value.en_name=m),minlength:"1",maxlength:"15"},null,8,["modelValue"])]),_:1}),e(g,{label:"所属类型",prop:"cate_alias"},{default:n(()=>[e(t,{modelValue:a.value.type,"onUpdate:modelValue":o[2]||(o[2]=m=>a.value.type=m),disabled:!0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ze={class:"header"},$e={class:"search"},Le={class:"addCate"},Te={style:{"margin-top":"20px"}},Ne={__name:"FirstCate",setup(B){const C=p(!1),w=xe(),u=ve(),a=p(),V=p(),f=p([]),c=p(""),s=p({pagesNum:1,pageSize:10}),_=async()=>{C.value=!0;const l=await fe(s.value.pagesNum,s.value.pageSize);console.log("获取所有分类",l),f.value=l.data.list,w.setFirstCate(f.value),C.value=!1},d=p(0),o=l=>{d.value=l,s.value.pagesNum=1},t=F(()=>f.value.filter(l=>l.type===u.pageType[d.value])),g=F(()=>{const l=f.value.filter(b=>b.type===u.pageType[d.value]);return c.value?l.filter(b=>b.name.includes(c.value)||b.en_name.toLowerCase().includes(c.value.toLowerCase())).length:l.length}),y=F(()=>{if(!t.value)return[];let l=t.value;c.value&&(l=t.value.filter(x=>x.name.includes(c.value)||x.en_name.toLowerCase().includes(c.value.toLowerCase())));const r=(s.value.pagesNum-1)*s.value.pageSize,b=r+s.value.pageSize;return l.slice(r,b)}),h=()=>{a.value.open({})},k=l=>{console.log(l),V.value.openSub(l)},m=l=>{a.value.open(l),_()},L=l=>{de.confirm("确定要删除此分类吗?").then(async()=>{const r=await ye(l._id);console.log(r,"删除"),await _(),q.success("删除成功")}).catch(()=>{})},U=l=>{L(l)},i=l=>{s.value.pagesNum=l},O=l=>{s.value.pageSize=l,s.value.pagesNum=1},W=()=>{_()};return ee(()=>{_()}),(l,r)=>{const b=A,x=P,z=ne,X=ie,Y=te,G=pe,H=re;return E(),N(D,null,[e(me,{title:"一级分类"},{extra:n(()=>[S("div",Le,[e(x,{type:"primary",onClick:h},{default:n(()=>r[3]||(r[3]=[$("添加分类")])),_:1})])]),default:n(()=>[S("div",ze,[e(be,{onChangeType:o}),S("div",$e,[e(b,{modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=v=>c.value=v),style:{width:"240px","margin-right":"40px"},placeholder:"根据当前类型搜索分类","suffix-icon":T(le)},null,8,["modelValue","suffix-icon"])])]),ae((E(),Z(Y,{data:y.value,style:{width:"100%"}},{empty:n(()=>[e(X,{description:"没有数据"})]),default:n(()=>[e(z,{label:"序号",align:"center",width:"100",type:"index"}),e(z,{label:"分类名称",align:"center",prop:"name"}),e(z,{label:"分类英文",align:"center",prop:"en_name"}),e(z,{label:"所属类型",align:"center",prop:"type"}),e(z,{label:"操作",align:"center",width:"180"},{default:n(({row:v})=>[e(x,{icon:T(oe),circle:"",plain:"",type:"success",onClick:I=>k(v)},null,8,["icon","onClick"]),e(x,{icon:T(se),circle:"",plain:"",type:"primary",onClick:I=>m(v)},null,8,["icon","onClick"]),e(x,{icon:T(ue),circle:"",plain:"",type:"danger",onClick:I=>U(v)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[H,C.value]]),S("div",Te,[e(G,{style:{"margin-top":"20px","justify-content":"flex-end"},"current-page":s.value.pagesNum,"onUpdate:currentPage":r[1]||(r[1]=v=>s.value.pagesNum=v),"page-size":s.value.pageSize,"onUpdate:pageSize":r[2]||(r[2]=v=>s.value.pageSize=v),"page-sizes":[1,5,10,15],layout:"jumper,total, sizes, prev, pager, next ",total:g.value,onSizeChange:O,onCurrentChange:i},null,8,["current-page","page-size","total"])])]),_:1}),e(Se,{ref_key:"dialog",ref:a,onSuccess:W},null,512),e(ke,{ref_key:"dialogSub",ref:V},null,512)],64)}}},Ye=Ce(Ne,[["__scopeId","data-v-0c5de432"]]);export{Ye as default};
