import{r as i,ad as F,a2 as te,X as y,b as a,w as s,e as ve,f as fe,h as oe,Y as ye,Z as w,_ as M,g as b,aj as be,z as he,i as Z,ak as Ce,p as se,m as V,a0 as xe,al as le,q as _,o as g,c as H,$ as Se,am as ae,L as Ve,ai as ke,a3 as Te,a4 as Ee,a5 as we,an as ze,a7 as Le,a8 as Me,a9 as Fe,aa as Ie,ab as Ae,W as Pe,ao as Ue}from"./index-jHQwErwV.js";/* empty css                        *//* empty css                      */import{P as Ne}from"./pageContainer-qlUKgolJ.js";/* empty css                     *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                   *//* empty css                     */import{u as $e,a as Be,g as Re,r as qe}from"./material-BJYmwKQa.js";import{c as ne,t as Ge}from"./pageTypes-x8DazHtP.js";import{g as je,e as De}from"./tag-q5XYjXzV.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as Oe}from"./pageTypes-D4R7tdjX.js";import{i as We}from"./request-Bf4HgDwi.js";const Je={class:"proChannelAdd"},Xe={class:"upload-container"},Ye={class:"tags"},Ze=["onClick"],He={class:"color-container"},Ke=["onClick"],Qe={class:"dialog-footer"},el={__name:"materialChannelAdd",emits:["success"],setup(I,{expose:h,emit:C}){const p=i(!1),t=i({_id:"",top_id:"",sub_id:"",name:"",en_name:"",cover_url:"",files_url:"",tags:[],colors:[],type:""}),k=ne(),S=i([]),v=i([]),m=async e=>{if(e)try{const l=await Ge(e);S.value=l.data,v.value=l.data.flatMap(d=>d.subCategories||[])}catch(l){console.error("获取分类列表失败:",l),_.error("获取分类列表失败")}},A=F(()=>S.value),z=e=>{console.log(e),t.value.sub_id=""},P=F(()=>v.value.filter(e=>e.parent_id===t.value.top_id)),L=i([]),U=async()=>{console.log("标签获取");const e=await je();console.log(e.data),L.value=e.data.list},N=e=>{console.log("标签",e);const l=t.value.tags.findIndex(d=>d===e.name);l===-1?t.value.tags.push(e.name):t.value.tags.splice(l,1)},$=e=>t.value.tags.includes(e),B=i({top_id:[{required:!0,message:"请选择所属分类",trigger:"change"}],sub_id:[{message:"请选择所属子分类",trigger:"change"}],name:[{required:!0,message:"请输入素材名称",trigger:"blur"}],en_name:[{message:"请输入素材英文名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],cover_url:[{required:!0,message:"请上传封面图",trigger:"change"}],files_url:[{required:!0,message:"请上传文件素材",trigger:"change"}],type:[{required:!0,message:"请选择所属类型",trigger:"change"}]}),R=F(()=>t.value._id?"编辑素材":"添加素材"),T=i([]),E=i([]),n=async(e={})=>{var d;p.value=!0,await U(),await J(),(d=X.value)==null||d.resetFields();const l=e._id?e.type:k.currentType;t.value.type=l,await m(l),t.value={_id:e._id||"",top_id:e.top_id||"",sub_id:e.sub_id||"",name:e.name||"",en_name:e.en_name||"",cover_url:e.cover_url||"",files_url:e.files_url||"",tags:Array.isArray(e.tags)?e.tags:[],colors:Array.isArray(e.colors)?e.colors:[],type:l},e.cover_url?T.value=[{name:"封面图",url:e.cover_url}]:T.value=[],e.files_url?E.value=[{name:"素材文件",url:e.files_url}]:E.value=[]},r=i(),q=e=>["image/jpeg","image/png","image/gif","image/bmp","image/webp","image/svg+xml"].includes(e.type)?!0:(_.error("请上传图片格式文件（JPG、PNG、GIF、BMP、WEBP、SVG）"),!1),x=e=>{r.value.clearFiles();const l=e[0];l.uid=le(),r.value.handleStart(l)},c=i(),G=e=>{c.value.clearFiles();const l=e[0];l.uid=le(),c.value.handleStart(l)},j=()=>!0,D=e=>{console.log("图片上传成功",e),t.value.cover_url=e,_.success("图片上传成功")},O=e=>{console.log(e),_.error("文件名已存在")},W=e=>{console.log("文件上传成功",e),t.value.files_url=e,_.success("文件上传成功")},u=i([]),J=async()=>{const e=await De();u.value=e.data.list},ie=e=>{console.log("颜色",e);const l=t.value.colors.findIndex(d=>d===e.color);l===-1?t.value.colors.push(e.color):t.value.colors.splice(l,1)},ue=e=>t.value.colors.includes(e);h({open:n});const ce=C,X=i(),de=async()=>{try{await X.value.validate(),t.value._id?(await $e(t.value),_.success("更新成功")):(await Be(t.value),_.success("添加成功")),p.value=!1,ce("success")}catch(e){console.error("提交失败:",e),_.error(e.message||"提交失败")}};return te(()=>{}),(e,l)=>{const d=oe,f=fe,K=Se,Q=ye,pe=he,ee=be,Y=se,ge=ve,me=xe;return g(),y("div",Je,[a(me,{modelValue:p.value,"onUpdate:modelValue":l[6]||(l[6]=o=>p.value=o),title:R.value,width:"40%"},{footer:s(()=>[b("span",Qe,[a(Y,{onClick:l[5]||(l[5]=o=>p.value=!1)},{default:s(()=>l[9]||(l[9]=[V("取消")])),_:1}),a(Y,{type:"primary",onClick:de},{default:s(()=>l[10]||(l[10]=[V("确认")])),_:1})])]),default:s(()=>[a(ge,{ref_key:"formRef",ref:X,model:t.value,rules:B.value,"label-width":"100px",style:{"padding-right":"30px"}},{default:s(()=>[a(f,{label:"所属类型",prop:"type"},{default:s(()=>[a(d,{modelValue:t.value.type,"onUpdate:modelValue":l[0]||(l[0]=o=>t.value.type=o),disabled:!0},null,8,["modelValue"])]),_:1}),a(f,{label:"所属分类",prop:"top_id"},{default:s(()=>[a(Q,{onChange:z,modelValue:t.value.top_id,"onUpdate:modelValue":l[1]||(l[1]=o=>t.value.top_id=o),placeholder:"请选择一级分类",style:{width:"240px"}},{default:s(()=>[(g(!0),y(w,null,M(A.value,o=>(g(),H(K,{key:o._id,label:o.name,value:o._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"所属子分类",prop:"sub_id"},{default:s(()=>[a(Q,{modelValue:t.value.sub_id,"onUpdate:modelValue":l[2]||(l[2]=o=>t.value.sub_id=o),placeholder:"请选择一级分类",style:{width:"240px"}},{default:s(()=>[(g(!0),y(w,null,M(P.value,o=>(g(),H(K,{key:o._id,label:o.name,value:o._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"素材名称",prop:"name"},{default:s(()=>[a(d,{modelValue:t.value.name,"onUpdate:modelValue":l[3]||(l[3]=o=>t.value.name=o),placeholder:"请输入素材名称"},null,8,["modelValue"])]),_:1}),a(f,{label:"素材英文",prop:"en_name"},{default:s(()=>[a(d,{modelValue:t.value.en_name,"onUpdate:modelValue":l[4]||(l[4]=o=>t.value.en_name=o),placeholder:"请输入素材英文名"},null,8,["modelValue"])]),_:1}),a(f,{label:"封面图",prop:"cover_url"},{default:s(()=>[b("div",Xe,[a(ee,{ref_key:"uploadRef",ref:r,action:"https://etnrve3alw.gzg.sealos.run/material-upload-cover","list-type":"picture-card","on-success":D,"on-error":O,"before-upload":q,"on-exceed":x,limit:1,"file-list":T.value},{default:s(()=>[a(pe,null,{default:s(()=>[a(Z(Ce))]),_:1})]),_:1},8,["file-list"])])]),_:1}),a(f,{label:"上传素材",prop:"files_url"},{default:s(()=>[a(ee,{ref_key:"uploadFileRef",ref:c,action:"https://etnrve3alw.gzg.sealos.run/material-upload-files","on-exceed":G,"before-upload":j,"on-success":W,limit:1,"file-list":E.value},{trigger:s(()=>[a(Y,{type:"primary"},{default:s(()=>l[7]||(l[7]=[V("选择文件")])),_:1})]),tip:s(()=>l[8]||(l[8]=[b("div",{class:"el-upload__tip"},"请上传素材压缩包",-1)])),_:1},8,["file-list"])]),_:1}),a(f,{label:"标签",prop:"tags"},{default:s(()=>[b("div",Ye,[(g(!0),y(w,null,M(L.value,o=>(g(),y("div",{class:ae(["tagItem",{"tag-selected":$(o.name)}]),key:o._id,onClick:_e=>N(o)},Ve(o.name),11,Ze))),128))])]),_:1}),a(f,{label:"颜色",prop:"colors"},{default:s(()=>[b("div",He,[(g(!0),y(w,null,M(u.value,o=>(g(),y("div",{class:ae(["colorItem",{"color-selected":ue(o.color)}]),key:o._id,onClick:_e=>ie(o),style:ke({backgroundColor:o.color})},null,14,Ke))),128))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}},ll=re(el,[["__scopeId","data-v-3a24a229"]]),al=(I,h,C,p)=>We.post("/material-search",{pagesNum:I,pagesSize:h,searchValue:C,materialType:p}),tl={class:"header"},ol={class:"search"},sl={style:{"margin-top":"20px"}},nl={__name:"MaterialView",setup(I){const h=i(),C=i(!0),p=i([]),t=i({pagesNum:1,pagesSize:10}),k=i(0),S=ne(),v=i(""),m=async()=>{C.value=!0;const n=await Re(t.value.pagesNum,t.value.pagesSize,S.currentType);console.log("所有素材",n),k.value=n.data.total,p.value=n.data.list,C.value=!1},A=async()=>{if(!v.value)return m();if(v.value){const n=await al(t.value.pagesNum,t.value.pagesSize,v.value,S.currentType);k.value=n.data.length,console.log("我是搜索",n),p.value=n.data}},z=i(0),P=n=>{z.value=n,t.value.pagesNum=1,v.value="",m()},L=F(()=>p.value.filter(n=>n.type===S.pageType[z.value])),U=n=>{t.value.pagesSize=n,m()},N=n=>{t.value.pagesNum=n,m()},$=()=>{h.value.open({})},B=n=>{h.value.open(n)},R=async n=>{console.log("删除",n),Pe.confirm("确定要删除此分类吗?").then(async()=>{const r=await qe(n._id);console.log(r),r.code===200?(await m(),_.success("删除成功")):_.error("删除失败")}).catch(()=>{})},T=()=>{Ue.push("/manySend")},E=()=>{m()};return te(()=>{m()}),(n,r)=>{const q=oe,x=se,c=we,G=ze,j=Fe,D=Ee,O=Ae,W=Ie;return g(),y(w,null,[a(Ne,{title:"素材管理"},{extra:s(()=>[a(x,{type:"success",onClick:T},{default:s(()=>r[5]||(r[5]=[V("批量发布")])),_:1}),a(x,{type:"primary",onClick:$},{default:s(()=>r[6]||(r[6]=[V("添加素材")])),_:1})]),default:s(()=>[b("div",tl,[a(Oe,{onChangeType:P}),b("div",ol,[a(q,{modelValue:v.value,"onUpdate:modelValue":r[0]||(r[0]=u=>v.value=u),style:{width:"240px","margin-right":"8px"},placeholder:"根据类型搜索素材",clearable:"",onClear:r[1]||(r[1]=u=>m())},null,8,["modelValue"]),a(x,{type:"primary",onClick:A},{default:s(()=>r[4]||(r[4]=[V("查询")])),_:1})])]),Te((g(),H(D,{data:L.value,style:{width:"100%"}},{empty:s(()=>[a(j,{description:"没有数据"})]),default:s(()=>[a(c,{label:"序号",align:"center",width:"60",type:"index"}),a(c,{label:"素材名称",align:"center",prop:"name"}),a(c,{label:"素材英文",align:"center",prop:"en_name"}),a(c,{label:"封面图",align:"center"},{default:s(u=>[a(G,{lazy:"",style:{width:"80px",height:"80px"},src:u.row.cover_url,fit:"cover"},null,8,["src"])]),_:1}),a(c,{label:"所属类型",align:"center",prop:"type"}),a(c,{label:"文件素材",align:"center","show-overflow-tooltip":"",prop:"files_url"}),a(c,{label:"标签",align:"center",width:"300",prop:"tags"}),a(c,{label:"颜色",align:"center",width:"300",prop:"colors"}),a(c,{label:"操作",align:"center",width:"160"},{default:s(({row:u})=>[a(x,{icon:Z(Le),circle:"",plain:"",type:"primary",onClick:J=>B(u)},null,8,["icon","onClick"]),a(x,{icon:Z(Me),circle:"",plain:"",type:"danger",onClick:J=>R(u)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[W,C.value]]),b("div",sl,[a(O,{style:{"margin-top":"20px","justify-content":"flex-end"},"current-page":t.value.pagesNum,"onUpdate:currentPage":r[2]||(r[2]=u=>t.value.pagesNum=u),"page-size":t.value.pagesSize,"onUpdate:pageSize":r[3]||(r[3]=u=>t.value.pagesSize=u),"page-sizes":[1,5,10,15],layout:"jumper,total, sizes, prev, pager, next ",total:k.value,onSizeChange:U,onCurrentChange:N},null,8,["current-page","page-size","total"])])]),_:1}),a(ll,{ref_key:"dialog",ref:h,onSuccess:E},null,512)],64)}}},Sl=re(nl,[["__scopeId","data-v-58ed5341"]]);export{Sl as default};
