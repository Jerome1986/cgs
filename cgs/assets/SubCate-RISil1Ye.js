import{r as c,X as N,b as l,w as r,e as W,f as X,h as U,Y,Z as $,_ as Z,g as V,p as B,m as I,a0 as H,q as T,o as S,c as F,$ as J,ad as z,a2 as K,a3 as Q,i as k,ac as ee,a4 as ae,a5 as te,a7 as le,a8 as ne,a9 as oe,aa as se,ab as ue,W as ie}from"./index-jHQwErwV.js";/* empty css                        *//* empty css                      */import{P as re}from"./pageContainer-qlUKgolJ.js";/* empty css                     *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                   *//* empty css                     */import{u as pe,b as ce,c as de,g as me,d as _e}from"./pageTypes-x8DazHtP.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as A}from"./cate-DmhFKeA5.js";import{P as ve}from"./pageTypes-D4R7tdjX.js";import"./request-Bf4HgDwi.js";const ge={class:"subChannelEdit"},fe={class:"dialog-footer"},ye={__name:"subChannelEdit",emits:["success"],setup(O,{expose:f,emit:x}){const v=c(!1),a=c({_id:null,name:"",en_name:"",type:"",parent_id:null,parent_name:null}),d=A().firstCate.map(o=>({label:o.name,value:o._id})),n=c(d),y=o=>{console.log("下拉框发生改变",o);const e=n.value.find(m=>m.value===o);console.log("改变后",e),e?a.value.parent_name=e.label:a.value.parent_name=null},b=c([]);f({open:o=>{if(v.value=!0,Object.keys(a.value).forEach(e=>{a.value[e]=o[e]||null}),o.parent_id){const e=n.value.find(m=>m.value===o.parent_id);e?a.value.parent_name=e.label:a.value.parent_name=null}else a.value.parent_name=null}});const C=x,E=c(null),w=async()=>{await E.value.validate(),console.log("提交前",a.value);const o={sub_id:a.value._id,parent_id:a.value.parent_id,name:a.value.name,en_name:a.value.en_name,type:a.value.type};a.value._id?(await pe(o),T({type:"success",message:"更新成功"})):(await ce(o),T({type:"success",message:"添加成功"})),v.value=!1,C("success")};return(o,e)=>{const m=U,h=X,L=J,t=Y,u=W,i=B,p=H;return S(),N("div",ge,[l(p,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=s=>v.value=s),title:a.value._id?"编辑分类":"添加分类",width:"30%"},{footer:r(()=>[V("span",fe,[l(i,{onClick:e[3]||(e[3]=s=>v.value=!1)},{default:r(()=>e[5]||(e[5]=[I("取消")])),_:1}),l(i,{type:"primary",onClick:w},{default:r(()=>e[6]||(e[6]=[I(" 确认 ")])),_:1})])]),default:r(()=>[l(u,{ref_key:"formRef",ref:E,model:a.value,rules:b.value,"label-width":"100px",style:{"padding-right":"30px"}},{default:r(()=>[l(h,{label:"分类名称",prop:"name"},{default:r(()=>[l(m,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.name=s),minlength:"1",maxlength:"10"},null,8,["modelValue"])]),_:1}),l(h,{label:"分类英文",prop:"cate_alias"},{default:r(()=>[l(m,{modelValue:a.value.en_name,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.en_name=s),minlength:"1",maxlength:"15"},null,8,["modelValue"])]),_:1}),l(h,{label:"所属父级",prop:"cate_alias"},{default:r(()=>[l(t,{disabled:!0,onChange:y,modelValue:a.value.parent_id,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.parent_id=s),placeholder:"Select",style:{width:"100px"}},{default:r(()=>[(S(!0),N($,null,Z(n.value,s=>(S(),F(L,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}},be=M(ye,[["__scopeId","data-v-d659a164"]]),Ce={class:"header"},he={class:"search"},Se={style:{"margin-top":"20px"}},xe={__name:"SubCate",setup(O){const f=c(!1),x=c(),v=A(),a=de(),g=c([]),d=c(""),n=c({pagesNum:1,pageSize:10}),y=async()=>{f.value=!0;const u=(await me()).data.list;g.value=u.flatMap(i=>i.subCategories),console.log("二级分类",g.value),v.setSubCate(g.value),f.value=!1},b=c(0),P=t=>{b.value=t,n.value.pagesNum=1},C=z(()=>g.value.filter(t=>t.type===a.pageType[b.value])),E=z(()=>{const t=g.value.filter(i=>i.type===a.pageType[b.value]);return d.value?t.filter(i=>i.name.includes(d.value)||i.en_name.toLowerCase().includes(d.value.toLowerCase())).length:t.length}),w=z(()=>{if(!C.value)return[];let t=C.value;d.value&&(t=C.value.filter(p=>p.name.includes(d.value)||p.en_name.toLowerCase().includes(d.value.toLowerCase())));const u=(n.value.pagesNum-1)*n.value.pageSize,i=u+n.value.pageSize;return t.slice(u,i)}),o=t=>{n.value.pagesNum=t},e=t=>{n.value.pageSize=t,n.value.pagesNum=1},m=async t=>{console.log("编辑",t),x.value.open(t)},h=t=>{console.log("删除",t),ie.confirm("确定要删除此分类吗?").then(async()=>{await _e(t.parent_id,t._id),await y(),T.success("删除成功")}).catch(()=>{})},L=()=>{y()};return K(()=>{y()}),(t,u)=>{const i=U,p=te,s=B,j=oe,D=ae,R=ue,q=se;return S(),N($,null,[l(re,{title:"二级分类"},{default:r(()=>[V("div",Ce,[l(ve,{onChangeType:P}),V("div",he,[l(i,{modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=_=>d.value=_),style:{width:"240px","margin-right":"40px"},placeholder:"根据当前类型搜索分类","suffix-icon":k(ee)},null,8,["modelValue","suffix-icon"])])]),Q((S(),F(D,{data:w.value,style:{width:"100%"}},{empty:r(()=>[l(j,{description:"没有数据"})]),default:r(()=>[l(p,{label:"序号",align:"center",width:"100",type:"index"}),l(p,{label:"分类名称",align:"center",prop:"name"}),l(p,{label:"分类英文",align:"center",prop:"en_name"}),l(p,{label:"所属父级",align:"center",prop:"parent_name"}),l(p,{label:"所属类型",align:"center",prop:"type"}),l(p,{label:"操作",align:"center",width:"100"},{default:r(({row:_})=>[l(s,{icon:k(le),circle:"",plain:"",type:"primary",onClick:G=>m(_)},null,8,["icon","onClick"]),l(s,{icon:k(ne),circle:"",plain:"",type:"danger",onClick:G=>h(_)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[q,f.value]]),V("div",Se,[l(R,{style:{"margin-top":"20px","justify-content":"flex-end"},"current-page":n.value.pagesNum,"onUpdate:currentPage":u[1]||(u[1]=_=>n.value.pagesNum=_),"page-size":n.value.pageSize,"onUpdate:pageSize":u[2]||(u[2]=_=>n.value.pageSize=_),"page-sizes":[1,5,10,15],layout:"jumper,total, sizes, prev, pager, next",total:E.value,onSizeChange:e,onCurrentChange:o},null,8,["current-page","page-size","total"])])]),_:1}),l(be,{ref_key:"dialog",ref:x,onSuccess:L},null,512)],64)}}},Ae=M(xe,[["__scopeId","data-v-c032bc29"]]);export{Ae as default};
