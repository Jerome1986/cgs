import{r as d,ad as N,a2 as Y,c as x,w as Q,o as c,g as r,b as A,Y as z,X as p,Z as y,_ as C,i as H,$ as Z,ag as L,L as b,a9 as q,p as P,m as R,q as g,W,ap as $}from"./index-Dq5YoMTe.js";/* empty css                  */import{P as ee}from"./pageContainer-BnKbueKC.js";/* empty css                     */import{c as ae,t as te}from"./pageTypes-DsWnsiwk.js";import{a as oe}from"./request-CjAdyTqz.js";import{a as se}from"./material-tBDfjUjU.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne="data:image/png;base64,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",ce={class:"cateSelect"},re={class:"showFile"},ie={class:"fileContent"},ue={class:"fileName"},de={class:"left"},pe={class:"name"},ge=["onClick"],me={key:0,class:"empty-files"},Ee={class:"submitBtn"},Be={__name:"ManySend",setup(fe){const k=ae(),m=d(""),M=()=>{E.value="",B.value="",h.value="",S.value="",D()},E=d(""),B=d(""),h=d(""),S=d(""),I=d([]),w=d([]),D=async()=>{const t=await te(m.value);I.value=t.data,w.value=t.data.flatMap(e=>e.subCategories||[])},K=t=>{B.value="",S.value="",h.value=t;const e=I.value.find(a=>a._id===t);e&&(E.value=e.name)},j=t=>{S.value=t;const e=w.value.find(a=>a._id===t);e&&(B.value=e.name)},i=d([]),u=d({uploading:!1,total:0,current:0,success:0,failed:0}),J=N(()=>{const t={};return i.value.forEach(e=>{const a=e.name.split(".")[0];t[a]||(t[a]=[]),t[a].push(e)}),t}),G=N(()=>{const t=[],e={};return Object.entries(J.value).forEach(([a,o])=>{e[a]||(e[a]=[]),o.forEach(l=>{e[a].push(l)})}),Object.entries(e).forEach(([a,o])=>{t.push({groupName:a,files:o})}),t}),F=t=>{i.value.filter(a=>a.name.split(".")[0]===t).forEach(a=>{const o=i.value.findIndex(l=>l.uid===a.uid);o!==-1&&i.value.splice(o,1)})},T=async(t,e)=>{try{const a=new FormData;a.append("file",t.raw),a.append("type",m.value),a.append("topCate",E.value),a.append("subCate",B.value||""),a.append("folderName",e);const o=await oe.post("https://etnrve3alw.gzg.sealos.run/material-upload-files",a,{headers:{"Content-Type":"multipart/form-data"}});return u.value.success++,o.data}catch(a){throw console.error("上传文件失败:",a),u.value.failed++,a}finally{u.value.current++}},V=t=>{const e=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg"],a=t.toLowerCase();return e.some(o=>a.endsWith(o))},U=t=>{const e=t.filter(a=>V(a.fileName));return e.length>0?e[0]:t[0]},_=async()=>{if(i.value.length===0){g.warning("请先选择文件");return}if(!m.value||!E.value||!h.value){g.warning("请选择分类");return}try{await W.confirm(`确定要上传 ${i.value.length} 个文件吗？将自动按文件名分组创建文件夹。`,"上传确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.value={uploading:!0,total:i.value.length,current:0,success:0,failed:0};const t=$.service({lock:!0,text:"正在上传文件...",background:"rgba(0, 0, 0, 0.7)"}),e=[];for(const[a,o]of Object.entries(J.value))for(const l of o)try{const n=await T(l,a);e.push({fileName:l.name,folderName:a,url:n,success:!0})}catch(n){e.push({fileName:l.name,folderName:a,error:n.message,success:!1})}if(t.close(),u.value.failed===0){g.success(`所有 ${u.value.total} 个文件上传成功！`),console.log("处理发布逻辑"),console.log("上传结果:",e);const a={};e.forEach(o=>{o.success&&(a[o.folderName]||(a[o.folderName]=[]),a[o.folderName].push(o))});for(const[o,l]of Object.entries(a)){console.log(`处理文件夹 ${o} 的发布逻辑`,l);try{const n=U(l),s={name:o,cover_url:n.url,files_url:l.filter(f=>f!==n).map(f=>f.url),top_id:h.value,sub_id:S.value||"",type:m.value,tags:[],colors:[],status:1};console.log("提交的素材数据:",s);const v=await se(s);console.log(`文件夹 ${o} 发布成功:`,v)}catch(n){console.error(`文件夹 ${o} 发布失败:`,n),g.error(`文件夹 ${o} 发布失败: ${n.message||"未知错误"}`)}}g.success("所有文件已上传并发布成功！")}else g.warning(`上传完成，成功 ${u.value.success} 个，失败 ${u.value.failed} 个`);i.value=[],u.value.uploading=!1}catch(t){t!=="cancel"&&g.error("上传过程中发生错误: "+t.message)}},O=()=>{const t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=e=>{Array.from(e.target.files).forEach(o=>{const l={uid:Date.now()+Math.random().toString(36).substring(2),name:o.name,size:o.size,raw:o};i.value.push(l)})},t.click()};return Y(()=>{}),(t,e)=>{const a=Z,o=z,l=q,n=P;return c(),x(ee,{title:"批量发布"},{default:Q(()=>[r("div",ce,[e[3]||(e[3]=r("div",{class:"title"},"所属分类",-1)),A(o,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),onChange:M,placeholder:"Select",size:"default",style:{width:"240px","margin-right":"10px"}},{default:Q(()=>[(c(!0),p(y,null,C(H(k).pageType,(s,v)=>(c(),x(a,{key:v,value:s},null,8,["value"]))),128))]),_:1},8,["modelValue"]),A(o,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=s=>E.value=s),onChange:K,placeholder:"Select",size:"default",style:{width:"240px","margin-right":"10px"}},{default:Q(()=>[(c(!0),p(y,null,C(I.value,s=>(c(),x(a,{key:s._id,label:s.name,value:s._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),A(o,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=s=>B.value=s),onChange:j,placeholder:"Select",size:"default",style:{width:"240px","margin-right":"10px"}},{default:Q(()=>[(c(!0),p(y,null,C(w.value,s=>(c(),x(a,{key:s._id,label:s.name,value:s._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),r("div",re,[e[5]||(e[5]=r("div",{class:"title"},"附件",-1)),r("div",ie,[(c(!0),p(y,null,C(G.value,(s,v)=>(c(),p("div",{class:"fileItem",key:v},[r("div",ue,[r("div",de,[e[4]||(e[4]=r("img",{src:ne,alt:"icon",style:{width:"18px",height:"18px"}},null,-1)),r("div",pe,b(s.groupName),1)]),r("div",{style:{cursor:"pointer",color:"#999999"},onClick:f=>F(s.groupName)},"删?",8,ge)]),(c(!0),p(y,null,C(s.files,(f,X)=>(c(),p("div",{key:X,class:"file",style:{"margin-top":"8px","background-color":"#fafafa",padding:"8px",color:"#a8a8a8","font-size":"14px"}},b(f.name),1))),128))]))),128)),i.value.length===0?(c(),p("div",me,[A(l,{description:"暂无文件，请点击'继续添加'选择文件"})])):L("",!0)])]),r("div",Ee,[A(n,{type:"primary",onClick:_},{default:Q(()=>e[6]||(e[6]=[R("发布上传")])),_:1}),A(n,{onClick:O},{default:Q(()=>e[7]||(e[7]=[R("继续添加")])),_:1})])]),_:1})}}},Ie=le(Be,[["__scopeId","data-v-696cb0f9"]]);export{Ie as default};
